name: Build Android APK

on:
  workflow_dispatch:  # –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ GitHub UI

jobs:
  build:
    runs-on: windows-2022  # —Ç–≤–æ–π .bat —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥ Windows

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Set up Android SDK + NDK
        uses: android-actions/setup-android@v3
        with:
          ndk: true
          cmdline-tools: true
          build-tools: "33.0.2"
          platforms: "android-33"

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–≤–æ–∏—Ö —Ñ–∞–π–ª–æ–≤
      - name: Verify build tool and script
        run: |
          if not exist "BuildToolCpp.exe" (exit 1)
          if not exist "[BUILD]BuildEngine[Android].bat" (exit 1)

      # üî• –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–≤–æ–π BAT-—Ñ–∞–π–ª ‚Äî –æ–Ω –¥–µ–ª–∞–µ—Ç –≤—Å—é —Ä–∞–±–æ—Ç—É
      - name: Run Android build script
        run: |
          .\"[BUILD]BuildEngine[Android].bat"

      # –ü–æ–∏—Å–∫ APK (–¥–æ–ø—É—Å—Ç–∏–º, —Ç–≤–æ–π –±–∏–ª–¥ —Å–æ–∑–¥–∞—ë—Ç output.apk –≤ –∫–æ—Ä–Ω–µ –∏–ª–∏ –≤ .build/)
      - name: Find APK
        id: find_apk
        run: |
          for /r %%i in (*.apk) do (
            echo APK_PATH=%%i >> %GITHUB_ENV%
            echo Found APK: %%i
            goto :done
          )
          echo ERROR: APK not found!
          exit 1
          :done

      # –ó–∞–≥—Ä—É–∑–∫–∞ APK –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
      - name: Upload APK
        uses: actions/upload-artifact@v3
        with:
          name: game-apk
          path: ${{ env.APK_PATH }}